# ç°ä»£åŒ– Web Anki æŠ€æœ¯æ–¹æ¡ˆï¼ˆå®Œæ•´ç‰ˆ v3ï¼‰

## ğŸ§­ 1. é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®çš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ª**æœ¬åœ°ä¼˜å…ˆ (Local-First)** çš„ç°ä»£åŒ–é—´éš”é‡å¤è®°å¿†ç³»ç»Ÿï¼Œæ ¸å¿ƒç†å¿µï¼š

> **æ•°æ®å±äºç”¨æˆ·ï¼ŒæœåŠ¡åªç”¨æ¥å¢å¼ºä½“éªŒã€‚**

### 1.1 äº§å“ç›®æ ‡ä¸å®šä½

- **æ ¸å¿ƒä½“éªŒ**
  - UI æ“ä½œé›¶æ„ŸçŸ¥å»¶è¿Ÿï¼Œæ‰€æœ‰ä¸»è¦æ“ä½œç›´æ¥å‘½ä¸­æœ¬åœ°æ•°æ®åº“ã€‚
  - å®Œå…¨ç¦»çº¿å¯ç”¨ï¼šæµè§ˆã€æ·»åŠ ã€å¤ä¹ ã€ç»Ÿè®¡å‡åœ¨æœ¬åœ°å®Œæˆã€‚
  - æ”¯æŒ Anki çº§åˆ«çš„å®šåˆ¶èƒ½åŠ›ï¼ˆå­—æ®µã€æ¨¡æ¿ã€è°ƒåº¦ç®—æ³•ï¼‰ã€‚

- **å¸‚åœºæ¨¡å¼ï¼šå»ä¸­å¿ƒåŒ–åˆ†å‘**
  - æ— éœ€ç™»å½•å³å¯æµè§ˆå…±äº«ç‰Œç»„å¸‚åœºã€‚
  - ä¸‹è½½å…±äº«ç‰Œç»„ â†’ å¯¼å…¥åˆ°æœ¬åœ° IndexedDB â†’ ä¹‹åå®Œå…¨ç§æœ‰ã€‚
  - åç«¯åªæä¾›"åªè¯»çš„ç‰Œç»„ç´¢å¼• + ç‰Œç»„æ–‡ä»¶åˆ†å‘"ã€‚

- **ç®€æ´æ¶æ„**
  - çº¯æœ¬åœ° + åªè¯»ç‰Œç»„å¸‚åœºï¼Œæ— äº‘åŒæ­¥ã€‚
  - åç«¯ä»…æä¾›å…±äº«ç‰Œç»„æœåŠ¡ï¼Œå‰ç«¯å®Œå…¨è‡ªæ²»ã€‚

### 1.2 äº§å“å®šä½

**æœ¬åœ°ä¼˜å…ˆåº”ç”¨ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰**

- **åç«¯**
  - ä»…ä½œä¸ºé™æ€èµ„æºä¸å…ƒæ•°æ®æœåŠ¡å™¨ï¼š
    - å…±äº«ç‰Œç»„åˆ—è¡¨ã€è¯¦æƒ…ï¼›
    - å…±äº«ç‰Œç»„åŒ…ä¸‹è½½ï¼›
    - ç®¡ç†ç«¯ï¼ˆä½œè€…ä¸Šä¼ /æ›´æ–°ç‰Œç»„ï¼‰ã€‚
- **å‰ç«¯**
  - Web + PWAï¼Œå…¨åŠŸèƒ½ç¦»çº¿åº”ç”¨ï¼š
    - æœ¬åœ° Deck/Note/Card ç®¡ç†ï¼›
    - FSRS / SM-2 åŒç®—æ³•è°ƒåº¦ï¼ˆå‰ç«¯å®ç°ï¼‰ï¼›
    - æ”¯æŒè‡ªå®¶æ ¼å¼å¯¼å…¥å¯¼å‡ºï¼›
    - æ‰‹åŠ¨æœ¬åœ°å¤‡ä»½ä¸æ•°æ®ç®¡ç†ã€‚

> **æ³¨æ„**ï¼šæœ¬é¡¹ç›®ä¸å®ç°äº‘åŒæ­¥åŠŸèƒ½ã€‚æ‰€æœ‰ç”¨æˆ·æ•°æ®å®Œå…¨å­˜å‚¨åœ¨æœ¬åœ° IndexedDBï¼Œç”¨æˆ·å¯¹æ•°æ®æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒã€‚

---

## ğŸ— 2. æŠ€æœ¯æ ˆä¸æ¶æ„åŸåˆ™

### 2.1 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|----------|------|
| **å‰ç«¯** | React + Vite + TypeScript + shadcn/ui | ç°ä»£å¼€å‘æ ˆï¼Œæ”¯æŒç»„ä»¶åŒ–ä¸è®¾è®¡ç³»ç»Ÿ |
| **ç¦»çº¿å­˜å‚¨** | IndexedDB + Dexie.js | Dexie ä½œä¸º ORMï¼Œé…åˆ `dexie-export-import` |
| **ID ç”Ÿæˆ** | NanoIDï¼ˆå‰ç«¯ç”Ÿæˆï¼‰ | é¿å…è‡ªå¢ IDï¼Œä¾¿äºæ•°æ®å¯¼å…¥å¯¼å‡º |
| **è°ƒåº¦ç®—æ³•** | ts-fsrs + è‡ªç ” SM-2 | FSRS v4/v5 + Classic æ¨¡å¼ï¼ˆå‰ç«¯å®ç°ï¼‰ |
| **åç«¯æ¡†æ¶** | FastAPI + Async SQLAlchemy | å¼‚æ­¥ IOï¼Œæ˜“å¼€å‘ã€æ€§èƒ½è¶³å¤Ÿ |
| **æ•°æ®åº“** | PostgreSQL | å­˜å‚¨ SharedDeck å…ƒæ•°æ® |
| **API é£æ ¼** | RESTful + JSON (Gzip/Brotli) | ç®€æ´æ˜“è°ƒè¯•ï¼Œå¯èµ° CDN |

### 2.2 æ¶æ„åŸåˆ™

- **Local-Firstï¼šæœ¬åœ°ä¼˜å…ˆ**
  - UI æ°¸è¿œä»¥æœ¬åœ° IndexedDB ä¸ºçœŸæºã€‚
  - åç«¯ä»…æä¾›å…±äº«ç‰Œç»„æœåŠ¡ï¼Œä¸å­˜å‚¨ç”¨æˆ·å­¦ä¹ æ•°æ®ã€‚

- **ID å‰ç½®ç”Ÿæˆ**
  - æ‰€æœ‰æ ¸å¿ƒå®ä½“ï¼ˆDeck, Note, Card, ReviewLog ç­‰ï¼‰ID å‡ç”±å‰ç«¯ç”Ÿæˆ NanoIDã€‚
  - ä¾¿äºæ•°æ®å¯¼å…¥å¯¼å‡ºï¼Œæ—  ID å†²çªé—®é¢˜ã€‚

- **ä¸å¯å˜æ€§ + è½¯åˆ é™¤**
  - æ•°æ®é»˜è®¤ä¸ç‰©ç†åˆ é™¤ï¼Œåªæ ‡è®° `deleted_at`ã€‚
  - ReviewLogã€å†å²æ•°æ®ä¿ç•™ï¼Œä¸ºæ•°æ®åˆ†æä¸å›æº¯åšå‡†å¤‡ã€‚

- **æ¨¡å‹ä¸è¡¨ç°é€‚åº¦è§£è€¦**
  - NoteModel å®šä¹‰å­—æ®µä¸"å¡ç‰‡ç±»å‹"ï¼›
  - å®ç°ä¸Šå¯ä»¥æ”¾åœ¨ä¸€èµ·å­˜ï¼Œä½†é€»è¾‘ä¸Šä¿æŒè¾¹ç•Œï¼Œæ–¹ä¾¿åæœŸæ¢çš®å‡çº§ã€‚

---

## ğŸ§© 3. é¢†åŸŸæ¨¡å‹ï¼ˆSchemaï¼‰

### 3.1 æœ¬åœ°æ ¸å¿ƒå®ä½“

#### Deckï¼ˆç‰Œç»„ï¼‰

- `id`: NanoIDï¼ˆä¸»é”®ï¼‰
- `name`: string
- `parent_id`: NanoID \| nullï¼ˆçˆ¶ç‰Œç»„ï¼‰
- `config`: JSONBï¼ˆè°ƒåº¦è®¾ç½®ã€æ˜¾ç¤ºè®¾ç½®ï¼‰
- `scheduler`: enum(`"sm2"`, `"fsrs_v4"`, `"fsrs_v5"`)
- `updated_at`: timestamp
- `deleted_at`: timestamp \| null

#### NoteModelï¼ˆç¬”è®°ç±»å‹ï¼‰

> æè¿°å­—æ®µç»“æ„ + è‡ªå¸¦æ¨¡æ¿å®šä¹‰ï¼ˆå¼ºç›¸å…³çš„ä¸€å¯¹å¤šå…³ç³»ï¼‰ã€‚

- `id`: NanoID
- `name`: string
- `fields`: JSONB
  ```jsonc
  [
    { "name": "Front" },
    { "name": "Back" },
    { "name": "Example" }
  ]
  ```
- `templates`: JSONB
  ```jsonc
  [
    {
      "ord": 0,
      "name": "æ­£å‘",
      "front": "<div class='card card--word'><div class='card-front'>{{Front}}</div></div>",
      "back": "<div class='card card--word'><div class='card-front'>{{Front}}</div><div class='card-back'>{{Back}}</div><div class='card-example'>{{Example}}</div></div>"
    }
  ]
  ```
- `updated_at`, `deleted_at`

> é€»è¾‘ä¸Šï¼š`fields` = æ•°æ®ç»“æ„ï¼Œ`templates` = æ¸²æŸ“å ä½å†…å®¹ã€‚

#### Noteï¼ˆç¬”è®°ï¼‰

- `id`: NanoID
- `guid`: stringï¼ˆè¯­ä¹‰å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºå…±äº«ç‰Œç»„å†…å®¹å»é‡ï¼‰
- `mid`: NanoIDï¼ˆNoteModel.idï¼‰
- `fields`: JSONBï¼ˆæ•°ç»„ä¸ NoteModel.fields å¯¹åº”ä½ç½®ï¼‰
- `tags`: string[]
- `deck_id`: NanoIDï¼ˆå½’å±ç‰Œç»„ï¼‰
- `updated_at`: timestamp
- `deleted_at`: timestamp \| null

#### Cardï¼ˆå¡ç‰‡ï¼‰

- `id`: NanoID
- `nid`: NanoIDï¼ˆNote.idï¼‰
- `ord`: intï¼ˆå¯¹åº” NoteModel.templates ä¸­çš„åºå·ï¼‰
- `deck_id`: NanoID
- **è°ƒåº¦å­—æ®µï¼ˆFSRS / SM-2 é€šç”¨ï¼‰**
  - `state`: enum(`"new"`, `"learning"`, `"review"`, `"relearning"`)
  - `due`: numberï¼ˆä¸‹ä¸€æ¬¡å¤ä¹ çš„æ—¶é—´æˆ³æˆ–å¤©ç¼–å·ï¼‰
  - `stability`: number
  - `difficulty`: number
  - `elapsed_days`: number
  - `scheduled_days`: number
  - `reps`: int
  - `lapses`: int
  - `last_review`: timestamp
- `updated_at`, `deleted_at`

#### ReviewLogï¼ˆå¤ä¹ æ—¥å¿—ï¼‰

- `id`: NanoID
- `cid`: NanoIDï¼ˆCard.idï¼‰
- `review_time`: timestamp
- `rating`: intï¼ˆ0~3/4ï¼Œæ˜ å°„"å†æ¥ä¸€æ¬¡ã€å›°éš¾ã€è‰¯å¥½ã€ç®€å•"ç­‰ï¼‰
- `state_before`, `state_after`
- `stability_before`, `stability_after`
- `elapsed_days`
- `scheduled_days`
- `created_at`

> åœ¨å…±äº«ç‰Œç»„å¯¼å‡ºæ—¶ä¸€èˆ¬ä¼š**æ¸…ç† ReviewLog**ï¼Œé¿å…æ³„éœ²ä¸ªäººè¡Œä¸ºæ•°æ®ã€‚

---

### 3.2 å…±äº«ç‰Œç»„ç›¸å…³å®ä½“ï¼ˆåç«¯å­˜å‚¨ï¼‰

#### SharedDeckï¼ˆå…±äº«ç‰Œç»„å…ƒæ•°æ®ï¼‰

- `id`: NanoID
- `slug`: stringï¼ˆç”¨äº URLï¼Œå¦‚ `toeic-800-core`ï¼‰
- `title`: string
- `description`: stringï¼ˆMarkdownï¼‰
- `language`: stringï¼ˆ`"zh-CN"`, `"en"` â€¦ï¼‰
- `tags`: string[]
- `author_id`: User.id
- `card_count`: intï¼ˆå†—ä½™ç»Ÿè®¡ï¼‰
- `note_count`: int
- `version`: intï¼ˆé€’å¢ï¼‰
- `content_hash`: stringï¼ˆæŸä¸ªç‰ˆæœ¬å†…å®¹çš„å“ˆå¸Œï¼‰
- `is_featured`: boolean
- `is_official`: boolean
- `download_count`: intï¼ˆä¸‹è½½æ¬¡æ•°ï¼‰
- `created_at`, `updated_at`, `deleted_at`

#### SharedDeckSnapshotï¼ˆå†…å®¹å¿«ç…§ï¼‰

- `id`: NanoID
- `shared_deck_id`: NanoID
- `version`: int
- `export_format_version`: intï¼ˆå¯¼å‡ºæ ¼å¼ç‰ˆæœ¬ï¼‰
- `file_url`: stringï¼ˆå®é™…å­˜å‚¨çš„ JSON/å‹ç¼©åŒ…åœ°å€ï¼‰
- `content_hash`: string
- `created_at`

> åç«¯åªéœ€è¦å­˜å…ƒæ•°æ® + æ–‡ä»¶ URLï¼Œæ–‡ä»¶æœ¬èº«å¯ä»¥æ”¾å¯¹è±¡å­˜å‚¨/CDNã€‚

### 3.3 SharedDeckExportï¼ˆå…±äº«ç‰Œç»„å¯¼å‡ºæ ¼å¼ï¼‰

> è¿™æ˜¯å…±äº«ç‰Œç»„çš„"è‡ªæœ‰æ ¼å¼"ï¼Œç”¨äºå¯¼å‡º/åˆ†å‘/å¯¼å…¥ã€‚

ç¤ºä¾‹ç»“æ„ï¼ˆJSONï¼‰ï¼š

```jsonc
{
  "format_version": 1,
  "shared_deck": {
    "id": "nanoid_shareddeck_1",
    "title": "æ‰˜ç¦æ ¸å¿ƒè¯æ±‡ï¼ˆç¤ºä¾‹ï¼‰",
    "description": "xxxx",
    "language": "en",
    "tags": ["è¯æ±‡", "æ‰˜ç¦"],
    "version": 3
  },
  "deck": {
    "id": "nanoid_deck_1",
    "name": "æ‰˜ç¦æ ¸å¿ƒè¯æ±‡",
    "config": {
      "scheduler": "fsrs_v4",
      "new_per_day": 30,
      "max_reviews_per_day": 200
    }
  },
  "note_models": [
    {
      "id": "nanoid_model_1",
      "name": "è‹±-ä¸­ å•è¯å¡",
      "fields": [
        { "name": "Front" },
        { "name": "Back" },
        { "name": "Example" }
      ],
      "templates": [
        {
          "ord": 0,
          "name": "æ­£å‘å¡ç‰‡",
          "front": "<div class='card card--word'><div class='word'>{{Front}}</div></div>",
          "back": "<div class='card card--word'><div class='word'>{{Front}}</div><div class='meaning'>{{Back}}</div><div class='example muted'>{{Example}}</div></div>"
        }
      ]
  ],
  "notes": [
    {
      "id": "nanoid_note_1",
      "guid": "word:abandon",
      "mid": "nanoid_model_1",
      "deck_id": "nanoid_deck_1",
      "fields": ["abandon", "æ”¾å¼ƒï¼›æŠ›å¼ƒ", "He abandoned the car in the snow."],
      "tags": ["æ ¸å¿ƒè¯æ±‡", "é«˜é¢‘"]
    }
    // ...
  ],
  "cards": [
    {
      "id": "nanoid_card_1",
      "nid": "nanoid_note_1",
      "ord": 0,
      "deck_id": "nanoid_deck_1",
      "state": "new",
      "due": 0
    }
    // ...
  ]
}
```

ç‰¹ç‚¹ï¼š

- å¯¹å‰ç«¯å¯¼å…¥æ¥è¯´ï¼Œå‡ ä¹å°±æ˜¯"Note/Card/Model/Deck çš„å¿«ç…§"ï¼›
- `guid` æ˜¯å…³é”®ï¼Œç”¨äºåç»­ç‰ˆæœ¬æ›´æ–°æ—¶ diffï¼›
- ä¸åŒ…å«ç”¨æˆ·ç›¸å…³æ•°æ®ï¼šæ—  ReviewLogï¼Œæ— ä¸ªäººç¬”è®°/æ ‡è®°ã€‚

---

## ğŸ”„ 4. æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 4.1 åˆ›å»ºç¬”è®°ä¸å¡ç‰‡ï¼ˆå‰ç«¯ï¼‰

**ä¼ªä»£ç ï¼š**

```ts
const createNote = (model: NoteModel, fields: string[], deckId: string) => {
  const now = Date.now();
  const noteId = nanoid();
  const note = {
    id: noteId,
    guid: generateGUID(fields[0]),  // åŸºäºç¬¬ä¸€ä¸ªå­—æ®µæˆ–å†…å®¹ hash
    mid: model.id,
    deck_id: deckId,
    fields,
    tags: [],
    updated_at: now
  };

  const cards = model.templates.map(tpl => ({
    id: nanoid(),
    nid: noteId,
    deck_id: deckId,
    ord: tpl.ord,
    state: "new",
    due: 0,
    stability: 0,
    difficulty: 0,
    reps: 0,
    lapses: 0,
    last_review: null,
    updated_at: now
  }));

  return { note, cards };
};
```

æµç¨‹è¦ç‚¹ï¼š

1. å‰ç«¯ç”Ÿæˆ Note ID / Card IDï¼ˆNanoIDï¼‰ã€‚
2. `guid` ç”¨äºè·¨ç‰Œç»„ç‰ˆæœ¬çš„å†…å®¹åŒ¹é…ã€‚

### 4.2 è°ƒåº¦ç®—æ³•ï¼ˆFSRS + SM-2 åŒå¼•æ“ï¼‰

**è°ƒåº¦æ¨¡å¼åœ¨è®¾ç½®ä¸­é…ç½®ï¼š**

- `scheduler = "sm2"`ï¼šClassic æ¨¡å¼ï¼›
- `scheduler = "fsrs_v4"` / `"fsrs_v5"`ï¼šä½¿ç”¨ ts-fsrsã€‚

**å¤ä¹ æµç¨‹ï¼ˆå‰ç«¯é€»è¾‘ï¼‰ï¼š**

1. ç”¨æˆ·ä»"ä»Šæ—¥å¾…å¤ä¹ é˜Ÿåˆ—"ä¸­æŠ½å– Cardï¼ˆç”±æœ¬åœ°ç®—æ³•è®¡ç®—ï¼‰ã€‚
2. ç”¨æˆ·ç»™å‡ºè¯„åˆ†ï¼š`Again / Hard / Good / Easy` â†’ æ˜ å°„åˆ° `rating`ï¼ˆ0~3/4ï¼‰ã€‚
3. æ ¹æ®è®¾ç½®é€‰æ‹©ç®—æ³•ï¼š
   - SM-2ï¼šè®¡ç®—ä¸‹ä¸€æ¬¡é—´éš”ã€ease factor ç­‰ï¼›
   - FSRSï¼šæ›´æ–° `stability` / `difficulty` / `due` ç­‰ã€‚
4. æ›´æ–° Card å­—æ®µï¼Œå†™å…¥ ReviewLogã€‚
5. æ›´æ–° Cardã€Note çš„ `updated_at`ã€‚

**ä¼˜åŒ–ç‚¹ï¼š**

- æ‰¹é‡è°ƒåº¦ï¼ˆå¦‚å¤§é‡å¯¼å…¥ååˆå§‹åŒ–ï¼‰å¯æ”¾å…¥ Web Workerã€‚
- FSRS å‚æ•°å¯åœ¨è®¾ç½®ä¸­è°ƒæ•´ï¼ˆè¿›é˜¶ç”¨æˆ·ä½¿ç”¨ï¼‰ã€‚

### 4.3 æ•°æ®æŒä¹…åŒ–ä¸å¤‡ä»½ç­–ç•¥

æµè§ˆå™¨ IndexedDB æœ‰è¢«ç³»ç»Ÿæ¸…ç†çš„å¯èƒ½ï¼Œéœ€å¤šå±‚é˜²å¾¡ï¼š

1. **æŒä¹…åŒ–å­˜å‚¨ç”³è¯·**
   - é¦–æ¬¡åŠ è½½æ—¶è°ƒç”¨ï¼š
     ```js
     if (navigator.storage && navigator.storage.persist) {
       navigator.storage.persist();
     }
     ```
   - è¯·æ±‚æµè§ˆå™¨å°†å­˜å‚¨æ ‡è®°ä¸º"æŒä¹…åŒ–"ï¼Œé™ä½è¢«æ¸…ç†é£é™©ã€‚

2. **æ‰‹åŠ¨å¯¼å‡º/å¯¼å…¥**
   - æ”¯æŒï¼š
     - æœ¬é¡¹ç›®åŸç”Ÿ `.json` æ ¼å¼å…¨é‡å¯¼å‡ºï¼›
     - å•ç‰Œç»„å¯¼å‡ºå¤‡ä»½ï¼›
     - å¯é€‰æ”¯æŒ Anki `.apkg` å¯¼å…¥ï¼ˆå†…éƒ¨è½¬æ¢ä¸ºæœ¬é¡¹ç›®ç»“æ„ï¼‰ã€‚

3. **æ•°æ®ç®¡ç†**
   - å­˜å‚¨ç©ºé—´æ˜¾ç¤ºï¼›
   - æ•°æ®ç»Ÿè®¡ï¼ˆç‰Œç»„æ•°ã€ç¬”è®°æ•°ã€å¡ç‰‡æ•°ã€å¤ä¹ è®°å½•æ•°ï¼‰ï¼›
   - æ¸…ç©ºæ‰€æœ‰æ•°æ®åŠŸèƒ½ï¼ˆå±é™©æ“ä½œï¼Œéœ€ç¡®è®¤ï¼‰ã€‚

---

### 4.4 å…±äº«ç‰Œç»„ä¸‹è½½ä¸å¯¼å…¥

**1ï¼‰æµè§ˆå…±äº«ç‰Œç»„**

- æ— éœ€ç™»å½•ï¼š
  - `GET /shared-decks?filter=...` è¿”å›åˆ—è¡¨ï¼›
  - `GET /shared-decks/{slug}` è¿”å›å…ƒæ•°æ® + æœ€æ–°ç‰ˆæœ¬ Snapshot ä¿¡æ¯ã€‚

**2ï¼‰ä¸‹è½½ SharedDeckExport**

- ä» `GET /shared-decks/{slug}/export` è·å– `SharedDeckExport` JSONã€‚
- å‰ç«¯è§£æåå¤„ç†ã€‚

**3ï¼‰å¯¼å…¥ç­–ç•¥**

- NoteModelï¼š
  - æœ¬åœ°æ— å¯¹åº” `id` â†’ ç›´æ¥åˆ›å»ºï¼›
  - æœ¬åœ°æœ‰åŒ `id`ï¼šä¿ç•™ç”¨æˆ·å·²æœ‰ç‰ˆæœ¬ï¼Œå¯¼å…¥æ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„ `id`ï¼ˆé¿å…å†²çªï¼‰ã€‚

- Deckï¼š
  - åˆ›å»ºæœ¬åœ° Deck è®°å½•ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰åç§°ã€‚

- Note & Cardï¼š
  - æŒ‰å¯¼å‡ºå†…å®¹åˆ›å»ºï¼›
  - `guid` ç”¨äºæœªæ¥ç‰ˆæœ¬æ›´æ–°æ—¶ diffï¼ˆæ­¤å¤„åˆæ¬¡å¯¼å…¥ç›´æ¥æ’å…¥ï¼‰ã€‚

---

### 4.5 å…±äº«ç‰Œç»„æ›´æ–°ï¼ˆDiff é€»è¾‘ï¼‰

å½“å…±äº«ç‰Œç»„æœ‰æ–°ç‰ˆæœ¬æ—¶ï¼š

1. å‰ç«¯æ‹‰å–æœ€æ–° SharedDeckExportï¼ˆvNextï¼‰ã€‚
2. éå† `notes`ï¼š
   - è‹¥æœ¬åœ°å­˜åœ¨ç›¸åŒ `guid`ï¼š
     - æ›´æ–° `fields`ï¼ˆå†…å®¹æ›´æ–°/çº é”™ï¼‰ï¼›
     - ä¸ä¿®æ”¹ Card çš„è°ƒåº¦çŠ¶æ€ï¼ˆ`stability`ã€`due` ç­‰ï¼‰ï¼Œ**ä¿ç•™ç”¨æˆ·å­¦ä¹ è¿›åº¦**ï¼›
   - è‹¥ `guid` ä¸å­˜åœ¨ï¼š
     - è§†ä¸ºæ–°å¢ Note/Cardï¼Œæ’å…¥æœ¬åœ°ã€‚
3. æ¨¡ç‰ˆæ›´æ–°ï¼š
   - NoteModel è‹¥æ˜¯å®˜æ–¹æ¨¡å‹ï¼Œå¯ä»¥æŒ‰ç­–ç•¥æ›´æ–°ã€‚

---

## ğŸŒ 5. API è®¾è®¡ï¼ˆRESTfulï¼‰

### 5.1 é€šç”¨å“åº”ç»“æ„

```json
{
  "success": true,
  "code": 200,
  "msg": "OK",
  "data": { },
  "trace_id": "req_x8s7d6f",
  "server_time": 1702296000
}
```

> `trace_id` ç”¨äºæ—¥å¿—å…³è”ä¸é—®é¢˜æ’æŸ¥ã€‚

### 5.2 å…±äº«ç‰Œç»„ç›¸å…³æ¥å£

- `GET /shared-decks`
  - æŸ¥è¯¢å‚æ•°ï¼š`page`, `page_size`, `language`, `tag`, `q` â€¦
  - è¿”å›ï¼šåˆ—è¡¨ + åˆ†é¡µä¿¡æ¯ã€‚

- `GET /shared-decks/{slug}`
  - è¿”å›ï¼š`SharedDeck` å…ƒæ•°æ® + æœ€æ–°ç‰ˆæœ¬å· + é¢„è§ˆä¿¡æ¯ã€‚

- `GET /shared-decks/{slug}/export`
  - è¿”å›ï¼š`SharedDeckExport` JSONã€‚

- `POST /shared-decks/{slug}/download`
  - å¢åŠ ä¸‹è½½è®¡æ•°ã€‚

- ç®¡ç†ç«¯ï¼ˆä½œè€…ç”¨ï¼‰ï¼š
  - `POST /admin/shared-decks`
  - `PUT /admin/shared-decks/{id}`
  - `POST /admin/shared-decks/{id}/snapshots`

---

## ğŸ” 6. å®‰å…¨ä¸æ€§èƒ½

### 6.1 å®‰å…¨è®¾è®¡

- **å…±äº«ç‰Œç»„æ•°æ®è„±æ•**
  - å¯¼å‡ºå…±äº«ç‰Œç»„æ—¶ï¼š
    - åˆ é™¤ ReviewLogï¼›
    - æ¸…ç†æ˜æ˜¾çš„ç§äººå­—æ®µï¼›
    - å¯¹ç”¨æˆ·è‡ªå®šä¹‰ HTML è¿›è¡Œç™½åå•è¿‡æ»¤ã€‚

- **å†…å®¹å®‰å…¨**
  - é¢„è§ˆä¸æ¸²æŸ“æ¨¡æ¿æ—¶ï¼Œå¯ä½¿ç”¨ï¼š
    - å®‰å…¨æ¨¡æ¿å¼•æ“ï¼ˆè½¬ä¹‰ HTMLï¼‰ï¼›
    - æˆ–å¯¹æ¨¡æ¿è¯­æ³•è¿›è¡Œé™åˆ¶ï¼Œåªå…è®¸ `{{Field}}` è¿™ç§å ä½ç¬¦ã€‚

### 6.2 æ€§èƒ½ä¼˜åŒ–

- **è™šæ‹Ÿæ»šåŠ¨**
  - å¡ç‰‡æµè§ˆå™¨ï¼ˆBrowserï¼‰ç•Œé¢ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨ï¼š
    - React Virtualized / React Windowï¼›
    - å¯å¹³æ»‘æµè§ˆä¸Šä¸‡æ¡ Noteã€‚

- **Web Worker**
  - å°†é‡ä»»åŠ¡æ”¾åˆ° Workerï¼š
    - FSRS è°ƒåº¦è®¡ç®—ï¼ˆå¤§æ‰¹é‡åˆå§‹åŒ–ï¼‰ï¼›
    - å¯¼å…¥ `.apkg` / `.json`ï¼›
    - å»ºç«‹å…¨æ–‡æœç´¢ç´¢å¼•ï¼ˆå¦‚ Lunr/FlexSearchï¼‰ã€‚
  - ä¸»çº¿ç¨‹ä»…è´Ÿè´£ UI äº¤äº’ä¸å‘ˆç°ã€‚

- **æŒ‰éœ€åŠ è½½**
  - å¤§å‹ç‰Œç»„å¯¼å…¥/æ¸²æŸ“åˆ†æ‰¹åŠ è½½ï¼›
  - æ¨¡æ¿æŒ‰éœ€åŠ è½½ã€‚

---

## ğŸ§¾ 7. æ€»ç»“ä¸æ–¹æ¡ˆä¼˜åŠ¿

1. **Local-First + NanoIDï¼š**
   - æ‰€æœ‰æ ¸å¿ƒè¡Œä¸ºéƒ½åœ¨æœ¬åœ°å®Œæˆï¼›
   - ä¸ä¾èµ–ç½‘ç»œï¼Œä¸æƒ§æœåŠ¡åœæœºï¼›
   - æ•°æ®å®Œå…¨å±äºç”¨æˆ·ï¼Œæ— éšç§æ³„éœ²é£é™©ã€‚

2. **å…±äº«ç‰Œç»„è‡ªæœ‰æ ¼å¼ + å†…ç½®å¥½çœ‹æ¨¡æ¿ï¼š**
   - ä¸è¢« AnkiShare å†å²åŒ…è¢±æŸç¼šï¼›
   - å¯è®¾è®¡ç»Ÿä¸€ã€ç¾è§‚ã€å¯ç»´æŠ¤çš„è§†è§‰ä½“ç³»ï¼›
   - ä½œè€…åˆæœŸå¯ä»¥å†…ç½®é«˜è´¨é‡ç‰Œç»„ä¸ä¸»é¢˜ï¼Œå¡‘é€ äº§å“é£æ ¼ã€‚

3. **FSRS + SM-2 åŒå¼•æ“ï¼š**
   - å¯¹æ–°æ‰‹ä¿ç•™ç»å…¸ä½“éªŒï¼ˆSM-2ï¼‰ï¼›
   - å¯¹é‡åº¦ç”¨æˆ·æä¾›æ›´é«˜æ•ˆçš„ FSRSï¼Œé•¿æœŸå‡å°‘æ— æ•ˆå¤ä¹ ã€‚

4. **ç®€æ´å¯ç»´æŠ¤çš„æ¶æ„ï¼š**
   - å®Œå…¨æœ¬åœ° + åªè¯»å¸‚åœºï¼Œåç«¯å‹åŠ›æå°ï¼›
   - æ— äº‘åŒæ­¥å¤æ‚æ€§ï¼Œä»£ç æ›´ç®€æ´ï¼›
   - NoteModel/Template çš„åˆ†å±‚è®¾è®¡ä¸ºæœªæ¥"æ¢çš®ã€å¯è§†åŒ–ç¼–è¾‘å™¨ã€å¤šä¸»é¢˜"ç•™è¶³ç©ºé—´ã€‚

æ•´ä½“ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ª**ä»¥æœ¬åœ°ä¸ºä¸­å¿ƒã€ä»¥å…±äº«ç‰Œç»„ä¸ºå…¥å£ã€ä»¥ FSRS ä¸ºæŠ€æœ¯å·®å¼‚ç‚¹ã€ä»¥æ¨¡æ¿ç³»ç»Ÿä¸ºå®¡ç¾ä¿è¯**çš„æ–¹æ¡ˆã€‚æŠ€æœ¯ä¸Šä¸éš¾è½åœ°ï¼Œæ¶æ„ç®€æ´ï¼Œä¸“æ³¨äºæ ¸å¿ƒä»·å€¼â€”â€”å¸®åŠ©ç”¨æˆ·é«˜æ•ˆå­¦ä¹ ã€‚

---

## ğŸ”® 8. æœªæ¥è§„åˆ’ï¼šç‰Œç»„å¼€å‘è€…å¹³å°

> æœ¬è§„åˆ’ç‹¬ç«‹äºå½“å‰å­¦ä¹ è€…åº”ç”¨ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç«™ç‚¹ã€‚

### 8.1 æ¦‚è¿°

ä¸ºç‰Œç»„å¼€å‘è€…æä¾›ä¸“å±å¹³å°ï¼Œæ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€å‘å¸ƒå’Œç®¡ç†å…±äº«ç‰Œç»„ã€‚

### 8.2 æ ¸å¿ƒåŠŸèƒ½

- **ç”¨æˆ·è®¤è¯**
  - æ³¨å†Œ/ç™»å½•ï¼ˆé‚®ç®±æˆ–ç¬¬ä¸‰æ–¹ OAuthï¼‰
  - å¼€å‘è€…èº«ä»½éªŒè¯

- **ç‰Œç»„ç®¡ç†**
  - å¯è§†åŒ–ç‰Œç»„ç¼–è¾‘å™¨
  - ç¬”è®°æ¨¡å‹è®¾è®¡å™¨
  - å¡ç‰‡æ¨¡æ¿ç¼–è¾‘ï¼ˆæ”¯æŒå®æ—¶é¢„è§ˆï¼‰
  - æ‰¹é‡å¯¼å…¥ç¬”è®°ï¼ˆCSV/Excelï¼‰

- **å‘å¸ƒæµç¨‹**
  - è‰ç¨¿ â†’ å®¡æ ¸ â†’ å‘å¸ƒ
  - ç‰ˆæœ¬ç®¡ç†ä¸æ›´æ–°
  - å‘å¸ƒè¯´æ˜ä¸æ›´æ–°æ—¥å¿—

- **æ•°æ®ç»Ÿè®¡**
  - ä¸‹è½½é‡ç»Ÿè®¡
  - ç”¨æˆ·åé¦ˆæ”¶é›†
  - ç‰Œç»„è´¨é‡è¯„åˆ†

### 8.3 ä¸å­¦ä¹ è€…åº”ç”¨çš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰Œç»„å¼€å‘è€…å¹³å°      â”‚      â”‚   å­¦ä¹ è€…åº”ç”¨ (PWA)   â”‚
â”‚  (éœ€è¦ç”¨æˆ·è®¤è¯)      â”‚      â”‚   (æ— éœ€ç™»å½•)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - åˆ›å»º/ç¼–è¾‘ç‰Œç»„      â”‚      â”‚ - æµè§ˆå…±äº«ç‰Œç»„å¸‚åœº   â”‚
â”‚ - è®¾è®¡ç¬”è®°æ¨¡å‹       â”‚ â”€â”€â”€â–º â”‚ - ä¸‹è½½å¯¼å…¥ç‰Œç»„       â”‚
â”‚ - å‘å¸ƒå…±äº«ç‰Œç»„       â”‚      â”‚ - æœ¬åœ°å­¦ä¹ å¤ä¹        â”‚
â”‚ - ç®¡ç†ç‰ˆæœ¬æ›´æ–°       â”‚      â”‚ - æ•°æ®å®Œå…¨æœ¬åœ°       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                            â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    å…±äº«ç‰Œç»„æœåŠ¡      â”‚
         â”‚   (åç«¯ API + DB)    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ä¸¤ä¸ªåº”ç”¨å…±äº«åŒä¸€ä¸ªåç«¯æœåŠ¡ï¼Œä½†é¢å‘ä¸åŒç”¨æˆ·ç¾¤ä½“ï¼š
> - å¼€å‘è€…å¹³å°ï¼šåˆ›ä½œè€…ï¼Œéœ€è¦è®¤è¯
> - å­¦ä¹ è€…åº”ç”¨ï¼šæ™®é€šç”¨æˆ·ï¼Œæ— éœ€ç™»å½•
